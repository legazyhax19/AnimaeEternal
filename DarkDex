-- à¹‚à¸«à¸¥à¸” Fluent GUI
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local Window = Fluent:CreateWindow({
    Title = "AutoFarm",
    SubTitle = "By You",
    TabWidth = 160,
    Size = UDim2.fromOffset(520, 400),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "swords" })
}

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸³à¸„à¸±à¸
local monsterMap = {} -- [à¸Šà¸·à¹ˆà¸­ Title] = { Id = id, Health = health, Reference = mob }
local selectedMonsterId = nil
local selectedMobData = nil
local autofarm = false
local lastTarget = nil

-- Dropdown UI
local monsterDropdown = Tabs.Main:AddDropdown("SelectMonster", {
    Title = "à¹€à¸¥à¸·à¸­à¸à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ",
    Values = {},
    Multi = false,
    Default = nil
})

monsterDropdown:OnChanged(function(title)
    selectedMobData = monsterMap[title]
    selectedMonsterId = selectedMobData and selectedMobData.Id
    Fluent:Notify({
        Title = "à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§",
        Content = "ID: " .. tostring(selectedMonsterId),
        Duration = 3
    })
end)

-- à¸›à¸¸à¹ˆà¸¡ Refresh à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ
Tabs.Main:AddButton({
    Title = "ğŸ”„ à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ",
    Callback = function()
        monsterMap = {}
        local titles = {}

        for _, mob in pairs(workspace.Debris.Monsters:GetChildren()) do
            local id = mob:GetAttribute("Monster_Id")
            local title = mob:GetAttribute("Title")
            local health = tonumber(mob:GetAttribute("Health"))

            if id and title and not monsterMap[title] then
                monsterMap[title] = {
                    Id = id,
                    Health = health or 0,
                    Reference = mob
                }
                table.insert(titles, title)
            end
        end

        monsterDropdown:SetValues(titles)
        Fluent:Notify({
            Title = "à¹‚à¸«à¸¥à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ",
            Content = "à¸à¸š " .. #titles .. " à¸•à¸±à¸§",
            Duration = 3
        })
    end
})

-- Toggle à¹€à¸›à¸´à¸”/à¸›à¸´à¸” AutoFarm
Tabs.Main:AddToggle("AutoFarmToggle", {
    Title = "ğŸš€ à¹€à¸£à¸´à¹ˆà¸¡à¸Ÿà¸²à¸£à¹Œà¸¡",
    Default = false,
    Callback = function(value)
        autofarm = value
    end
})

-- à¸¥à¸¹à¸›à¸§à¸²à¸£à¹Œà¸›à¸„à¸£à¸±à¹‰à¸‡à¹€à¸”à¸µà¸¢à¸§à¹à¸¥à¸°à¸£à¸­à¸•à¸±à¸§à¸•à¹ˆà¸­à¹„à¸›à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸­à¸™à¸•à¸²à¸¢
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local currentTarget = nil
local hasWarped = false
local warpStartTime = 0
local warpTimeout = 3 -- à¸§à¸´à¸™à¸²à¸—à¸µ

local function setupTargetDeathListener(humanoid)
    if humanoid then
        if humanoid:FindFirstChild("__AutofarmDeath") then
            humanoid:FindFirstChild("__AutofarmDeath"):Destroy()
        end

        local tag = Instance.new("ObjectValue")
        tag.Name = "__AutofarmDeath"
        tag.Value = humanoid
        tag.Parent = humanoid

        humanoid.Died:Connect(function()
            currentTarget = nil
            hasWarped = false
        end)
    end
end

RunService.Heartbeat:Connect(function()
    if autofarm and selectedMonsterId then
        if not currentTarget or not currentTarget.Parent then
            currentTarget = nil
            hasWarped = false
        end

        -- à¸«à¸²à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¹ƒà¸«à¸¡à¹ˆ
        if not currentTarget then
            for _, mob in pairs(workspace.Debris.Monsters:GetChildren()) do
                if mob:GetAttribute("Monster_Id") == selectedMonsterId then
                    local humanoid = mob:FindFirstChildOfClass("Humanoid")
                    if humanoid and humanoid.Health > 0 then
                        currentTarget = mob
                        setupTargetDeathListener(humanoid)
                        break
                    end
                end
            end
        end

        -- à¸§à¸²à¸£à¹Œà¸›à¸œà¹ˆà¸²à¸™à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ
        if currentTarget and not hasWarped then
            ReplicatedStorage.Events.To_Server:FireServer({
                ["Id"] = currentTarget.Name, -- à¹ƒà¸Šà¹‰à¸Šà¸·à¹ˆà¸­ mob à¸«à¸£à¸·à¸­ selectedMonsterId à¸•à¸²à¸¡à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ
                ["Action"] = "Teleport"
            })
            hasWarped = true
            warpStartTime = tick()
        end

        -- fallback à¸«à¸²à¸à¸§à¸²à¸£à¹Œà¸›à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸ à¸²à¸¢à¹ƒà¸™à¹€à¸§à¸¥à¸²
        if hasWarped and tick() - warpStartTime > warpTimeout then
            currentTarget = nil
            hasWarped = false
        end
    else
        currentTarget = nil
        hasWarped = false
    end
end)






