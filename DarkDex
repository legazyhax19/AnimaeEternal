-- ‡πÇ‡∏´‡∏•‡∏î Fluent GUI
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local Window = Fluent:CreateWindow({
    Title = "AutoFarm",
    SubTitle = "By You",
    TabWidth = 160,
    Size = UDim2.fromOffset(520, 400),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "swords" })
}

-- Toggle Dungeon
local autofarmDungeon = false
Tabs.Main:AddToggle("AutoFarmDungeonToggle", {
    Title = "üè∞ AutoFarm Dungeon",
    Default = false,
    Callback = function(value)
        autofarmDungeon = value
    end
})

-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local currentTarget = nil
local hasWarped = false
local discoveredMonsterId = nil -- ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö Monster_Id ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠

-- ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏°‡∏≠‡∏ô‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
local function setupTargetDeathListener(humanoid)
    if humanoid then
        if humanoid:FindFirstChild("__AutofarmDeath") then
            humanoid:FindFirstChild("__AutofarmDeath"):Destroy()
        end

        local tag = Instance.new("ObjectValue")
        tag.Name = "__AutofarmDeath"
        tag.Value = humanoid
        tag.Parent = humanoid

        humanoid.Died:Connect(function()
            currentTarget = nil
            hasWarped = false
        end)
    end
end

-- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Monster_Id ‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠
RunService.Heartbeat:Connect(function()
    if autofarmDungeon then
        if not currentTarget or not currentTarget.Parent then
            currentTarget = nil
            hasWarped = false
        end

        if not currentTarget then
            for _, mob in pairs(workspace.Debris.Monsters:GetChildren()) do
                local id = mob:GetAttribute("Monster_Id")
                local humanoid = mob:FindFirstChildOfClass("Humanoid")

                if humanoid and humanoid.Health > 0 then
                    if not discoveredMonsterId then
                        discoveredMonsterId = id -- ‡πÄ‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ ID ‡∏ô‡∏µ‡πâ‡∏ï‡∏•‡∏≠‡∏î
                        Fluent:Notify({
                            Title = "üéØ ‡∏û‡∏ö Monster_Id ‡πÅ‡∏•‡πâ‡∏ß",
                            Content = "ID: " .. tostring(id),
                            Duration = 3
                        })
                    end

                    if id == discoveredMonsterId then
                        currentTarget = mob
                        setupTargetDeathListener(humanoid)
                        break
                    end
                end
            end
        end

        if currentTarget and not hasWarped then
            local mobHRP = currentTarget:FindFirstChild("HumanoidRootPart")
            if mobHRP and character and character.PrimaryPart then
                local safeOffset = Vector3.new(0, 3, -2)
                character:SetPrimaryPartCFrame(mobHRP.CFrame + safeOffset)
                hasWarped = true
            end
        end
    else
        currentTarget = nil
        hasWarped = false
        discoveredMonsterId = nil -- ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏≤‡∏£‡πå‡∏°
    end
end)
